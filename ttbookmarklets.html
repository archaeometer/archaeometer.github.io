<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Durham timetable bookmarklet utilities</title>
<style>
body {margin: 5%;}
h1 {color:purple;
    background-color:lightgray;
    text-align: center;}
* {font-familY: sans-serif;}
em {background-color:lightgray;}
.footer {background-color:Thistle;
         text-align: center;}
</style>
</head>

<body>

<h1>Durham timetable bookmarklet utilities</h1>

<p>Created by Andrew Millard, August 2020. Updated September 2021.</p>
<!-- 
Use this to convert the js to encoded html for a draggable link https://www.web2generators.com/html-based-tools/online-html-entities-encoder-and-decoder 
-->

<p>These two utilities are designed to save time when dealing with the output of the <a href="https://timetable.dur.ac.uk/">DU timetable</a>. As currently written they only work for the 2020-21 academic year. I have only tested them on Firefox, Chrome and Edge on Windows 10.</p>

<h2>Bookmarklet to display teaching weeks: </h2>

<p>To install drag this link to your bookmark or favourites toolbar or right-click and add it to your bookmarks or favourites: 
<a href="
javascript:(function(){ /* TeachingWeeks.js to add teaching weeks to list format Durham University 2020-21 timetable. By Andrew Millard 2020-08-28 */ var teachingWeeks = [&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;Induction&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;Xmas vac 1&quot;,&quot;Xmas vac 2&quot;,&quot;Xmas vac 3&quot;,&quot;Xmas vac 4&quot;,&quot;11&quot;,&quot;12&quot;,&quot;13&quot;,&quot;14&quot;,&quot;15&quot;,&quot;16&quot;,&quot;17&quot;,&quot;18&quot;,&quot;19&quot;,&quot;20&quot;,&quot;Easter vac 1&quot;,&quot;Easter vac 2&quot;,&quot;Easter vac 3&quot;,&quot;Easter vac 4&quot;,&quot;Easter vac 5&quot;,&quot;21&quot;,&quot;22&quot;,&quot;Exam 1&quot;,&quot;Exam 2&quot;,&quot;Exam 3&quot;,&quot;Exam 4&quot;,&quot;Easter Term 7&quot;,&quot;Easter Term 8&quot;,&quot;Easter Term 9&quot;,&quot;Summer vac 1&quot;,&quot;Summer vac 2&quot;,&quot;Summer vac 3&quot;]; if (window.location.href.lastIndexOf(&quot;timetable.dur.ac.uk/reporting/&quot;)==-1) { alert(&quot;Not on the Durham University timetable site, or no search done!&quot;); } else if (window.location.href.lastIndexOf(&quot;timetable.dur.ac.uk/reporting/individual&quot;)!=-1) { if (confirm('This is a Grid (Individual) display\nAutomatically switch to list display?')){ str = window.location.href; str = str.replace(/individual/g,'textspreadsheet'); window.location.assign(str); } } else if (window.location.href.lastIndexOf(&quot;timetable.dur.ac.uk/reporting/Master&quot;)!=-1) { if (confirm('This is a Grid (Combined) display\nAutomatically switch to list display?')){ str = window.location.href; str = str.replace(/Master/g,'textspreadsheet'); window.location.assign(str); } } else { var Tables = document.getElementsByTagName(&quot;table&quot;); for (var i = 0; i&lt;Tables.length; i++){ timetableTable = 0; for (var j=0; j&lt;Tables[i].rows.length; j++){ if (j==0) { for (var k = 0; k &lt; Tables[i].rows[j].cells.length; k++){ cellContent = Tables[i].rows[j].cells[k].innerHTML; if (cellContent==&quot;Weeks&quot;) { timetableTable = 1; weeksCol = k; newCell = Tables[i].rows[j].insertCell(-1); newCell.innerHTML = &quot;Teaching weeks&quot;; } } } else if (timetableTable==1) { timetableWeeks = Tables[i].rows[j].cells[weeksCol].innerHTML; ttWeekNums = timetableWeeks.match(/\d+/g); ttWeekSeps = timetableWeeks.match(/[, -]+/g); newCell = Tables[i].rows[j].insertCell(-1); newText = teachingWeeks[ttWeekNums[0]-1]; for (var m=1; m&lt;ttWeekNums.length; m++){ newText += ttWeekSeps[m-1] + teachingWeeks[ttWeekNums[m]-1]; } newCell.innerHTML = newText; } } } alert(&quot;Inserted 2021-22 teaching weeks.&quot;); }; })();
">tt2tw</a>
</p>

<p>This utility is designed to work on list-style output from the Durham University online timetable. When on the timetable results page simply click on the bookmark to add a column of teaching week numbers to each table in the output. If you try to use it on any other webpage it will generate an error message and do nothing.</p>


<h2>Bookmarklet to generate calendar entries</h2>

<p>To install drag this link to your bookmark or favourites toolbar or right-click and add it to your bookmarks or favourites: 
<a href="javascript:javascript:(function(){ /* timetableToCalendar.js to create calendar entries from list format Durham University 2021-22 timetable output. By Andrew Millard 2020-08-28 updated 2021-07-02*/ /* icsFormatter used from https://github.com/matthiasanderer/icsFormatter */ /* modified so that busy is set with TRANSP=OPAQUE */ var icsFormatter = function() { 'use strict'; if (navigator.userAgent.indexOf('MSIE') &gt; -1 &amp;&amp; navigator.userAgent.indexOf('MSIE 10') == -1) { console.log('Unsupported Browser'); return; } var SEPARATOR = (navigator.appVersion.indexOf('Win') !== -1) ? '\r\n' : '\n'; var calendarEvents = []; var calendarStart = [ 'BEGIN:VCALENDAR', 'VERSION:2.0' ].join(SEPARATOR); var calendarEnd = SEPARATOR + 'END:VCALENDAR'; return { /** * Returns events array * @return {array} Events */ 'events': function() { return calendarEvents; }, /** * Returns calendar * @return {string} Calendar in iCalendar format */ 'calendar': function() { return calendarStart + SEPARATOR + calendarEvents.join(SEPARATOR) + calendarEnd; }, /** * Add event to the calendar * @param {string} subject Subject/Title of event * @param {string} description Description of event * @param {string} location Location of event * @param {string} begin Beginning date of event * @param {string} stop Ending date of event */ 'addEvent': function(subject, description, location, begin, stop) { /* I'm not in the mood to make these optional... So they are all required */ if (typeof subject === 'undefined' || typeof description === 'undefined' || typeof location === 'undefined' || typeof begin === 'undefined' || typeof stop === 'undefined' ) { return false; } /*TODO add time and time zone? use moment to format?*/ var start_date = new Date(begin); var end_date = new Date(stop); var start_year = (&quot;0000&quot; + (start_date.getFullYear().toString())).slice(-4); var start_month = (&quot;00&quot; + ((start_date.getMonth() + 1).toString())).slice(-2); var start_day = (&quot;00&quot; + ((start_date.getDate()).toString())).slice(-2); var start_hours = (&quot;00&quot; + (start_date.getHours().toString())).slice(-2); var start_minutes = (&quot;00&quot; + (start_date.getMinutes().toString())).slice(-2); var start_seconds = (&quot;00&quot; + (start_date.getMinutes().toString())).slice(-2); var end_year = (&quot;0000&quot; + (end_date.getFullYear().toString())).slice(-4); var end_month = (&quot;00&quot; + ((end_date.getMonth() + 1).toString())).slice(-2); var end_day = (&quot;00&quot; + ((end_date.getDate()).toString())).slice(-2); var end_hours = (&quot;00&quot; + (end_date.getHours().toString())).slice(-2); var end_minutes = (&quot;00&quot; + (end_date.getMinutes().toString())).slice(-2); var end_seconds = (&quot;00&quot; + (end_date.getMinutes().toString())).slice(-2); /* Since some calendars don't add 0 second events, we need to remove time if there is none... */ var start_time = ''; var end_time = ''; if (start_minutes + start_seconds + end_minutes + end_seconds !== 0) { start_time = 'T' + start_hours + start_minutes + start_seconds; end_time = 'T' + end_hours + end_minutes + end_seconds; } var start = start_year + start_month + start_day + start_time; var end = end_year + end_month + end_day + end_time; var calendarEvent = [ 'BEGIN:VEVENT', 'CLASS:PUBLIC', 'DESCRIPTION:' + description, 'DTSTART;VALUE=DATE:' + start, 'DTEND;VALUE=DATE:' + end, 'LOCATION:' + location, 'SUMMARY;LANGUAGE=en-us:' + subject, 'TRANSP:OPAQUE', 'END:VEVENT' ].join(SEPARATOR); calendarEvents.push(calendarEvent); return calendarEvent; }, /** * Download calendar using the saveAs function from filesave.js * @param {string} filename Filename * @param {string} ext Extention */ 'download': function(filename, ext) { if (calendarEvents.length &lt; 1) { return false; } ext = (typeof ext !== 'undefined') ? ext : '.ics'; filename = (typeof filename !== 'undefined') ? filename : 'calendar'; var calendar = calendarStart + SEPARATOR + calendarEvents.join(SEPARATOR) + calendarEnd; window.open( &quot;data:text/calendar;charset=utf8,&quot; + escape(calendar)); } }; }; if (typeof define === &quot;function&quot; &amp;&amp; define.amd) { /* AMD Format */ define(&quot;icsFormatter&quot;, [], function() { return icsFormatter(); }); } else if (typeof module === &quot;object&quot; &amp;&amp; module.exports) { /* CommonJS Format */ module.exports = icsFormatter(); } else { /* Plain Browser Support */ this.myModule = icsFormatter(); } /* start of my code */ var teachingWeeks = [&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;NA&quot;,&quot;Induction&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;Xmas vac 1&quot;,&quot;Xmas vac 2&quot;,&quot;Xmas vac 3&quot;,&quot;Xmas vac 4&quot;,&quot;11&quot;,&quot;12&quot;,&quot;13&quot;,&quot;14&quot;,&quot;15&quot;,&quot;16&quot;,&quot;17&quot;,&quot;18&quot;,&quot;19&quot;,&quot;20&quot;,&quot;Easter vac 1&quot;,&quot;Easter vac 2&quot;,&quot;Easter vac 3&quot;,&quot;Easter vac 4&quot;,&quot;Easter vac 5&quot;,&quot;21&quot;,&quot;22&quot;,&quot;Exam 1&quot;,&quot;Exam 2&quot;,&quot;Exam 3&quot;,&quot;Exam 4&quot;,&quot;Easter Term 7&quot;,&quot;Easter Term 8&quot;,&quot;Easter Term 9&quot;,&quot;Summer vac 1&quot;,&quot;Summer vac 2&quot;,&quot;Summer vac 3&quot;]; var weekStartDates = [&quot;2021-07-19&quot;,&quot;2021-07-26&quot;,&quot;2021-08-02&quot;,&quot;2021-08-09&quot;,&quot;2021-08-16&quot;,&quot;2021-08-23&quot;,&quot;2021-08-30&quot;,&quot;2021-09-06&quot;,&quot;2021-09-13&quot;,&quot;2021-09-20&quot;,&quot;2021-09-27&quot;,&quot;2021-10-04&quot;,&quot;2021-10-11&quot;,&quot;2021-10-18&quot;,&quot;2021-10-25&quot;,&quot;2021-11-01&quot;,&quot;2021-11-08&quot;,&quot;2021-11-15&quot;,&quot;2021-11-22&quot;,&quot;2021-11-29&quot;,&quot;2021-12-06&quot;,&quot;2021-12-13&quot;,&quot;2021-12-20&quot;,&quot;2021-12-27&quot;,&quot;2022-01-03&quot;,&quot;2022-01-10&quot;,&quot;2022-01-17&quot;,&quot;2022-01-24&quot;,&quot;2022-01-31&quot;,&quot;2022-02-07&quot;,&quot;2022-02-14&quot;,&quot;2022-02-21&quot;,&quot;2022-02-28&quot;,&quot;2022-03-07&quot;,&quot;2022-03-14&quot;,&quot;2022-03-21&quot;,&quot;2022-03-28&quot;,&quot;2022-04-04&quot;,&quot;2022-04-11&quot;,&quot;2022-04-18&quot;,&quot;2022-04-25&quot;,&quot;2022-05-02&quot;,&quot;2022-05-09&quot;,&quot;2022-05-16&quot;,&quot;2022-05-23&quot;,&quot;2022-05-30&quot;,&quot;2022-06-06&quot;,&quot;2022-06-13&quot;,&quot;2022-06-20&quot;,&quot;2022-06-27&quot;,&quot;2022-07-04&quot;,&quot;2022-07-11&quot;]; var daysOfWeek = [&quot;Monday&quot;,&quot;Tuesday&quot;,&quot;Wednesday&quot;,&quot;Thursday&quot;,&quot;Friday&quot;,&quot;Saturday&quot;,&quot;Sunday&quot;]; var calEntry = icsFormatter(); function stripNBSP(str){ return str.replace(/&amp;nbsp;/g,' '); } if (window.location.href.lastIndexOf(&quot;timetable.dur.ac.uk/reporting/&quot;)==-1) { alert(&quot;Not on the Durham University timetable site, or no search done!&quot;); } else if (window.location.href.lastIndexOf(&quot;timetable.dur.ac.uk/reporting/individual&quot;)!=-1) { if (confirm('This is a Grid (Individual) display\nAutomatically switch to list display?')){ str = window.location.href; str = str.replace(/individual/g,'textspreadsheet'); window.location.assign(str); } } else if (window.location.href.lastIndexOf(&quot;timetable.dur.ac.uk/reporting/Master&quot;)!=-1) { if (confirm('This is a Grid (Combined) display\nAutomatically switch to list display?')){ str = window.location.href; str = str.replace(/Master/g,'textspreadsheet'); window.location.assign(str); } } else { var Tables = document.getElementsByTagName(&quot;table&quot;); var nEvents = 0; for (var i = 0; i&lt;Tables.length; i++){ if (Tables[i].rows.length&gt;0 &amp;&amp; Tables[i].rows[0].cells[0].innerHTML == &quot;Activity&quot;) { var itemDay = Tables[i].previousSibling.previousSibling.firstChild.innerHTML; for (d=0;d&lt;7;d++) { if (itemDay == daysOfWeek[d]) { var dayOffset = d; } } for (var j=1; j&lt;Tables[i].rows.length; j++){ var itemActivity = stripNBSP(Tables[i].rows[j].cells[0].innerHTML); var itemDescription = stripNBSP(Tables[i].rows[j].cells[1].innerHTML); var itemModule = stripNBSP(Tables[i].rows[j].cells[2].innerHTML); var itemStart = stripNBSP(Tables[i].rows[j].cells[3].innerHTML); var itemEnd = stripNBSP(Tables[i].rows[j].cells[4].innerHTML); var itemDuration = stripNBSP(Tables[i].rows[j].cells[5].innerHTML); var itemRoom = stripNBSP(Tables[i].rows[j].cells[6].innerHTML); var itemStaff = stripNBSP(Tables[i].rows[j].cells[7].innerHTML); var itemWeeks = stripNBSP(Tables[i].rows[j].cells[8].innerHTML); var itemSize = stripNBSP(Tables[i].rows[j].cells[9].innerHTML); ttWeekNums = itemWeeks.match(/\d+/g); ttWeekSeps = itemWeeks.match(/[, -]+/g); /* generate full list of weeks from abbreviated form */ var weeksList = [parseInt(ttWeekNums[0])]; for (var k=1; k&lt;ttWeekNums.length; k++){ if (ttWeekSeps[k-1] == &quot;-&quot;) { for (m=parseInt(ttWeekNums[k-1])+1;m&lt;parseInt(ttWeekNums[k])+1;m++){ weeksList[weeksList.length] = m; } } else { weeksList[weeksList.length] = parseInt(ttWeekNums[k]); } } /* process data to format for icsFormatter */ var title = itemActivity+' '+itemDescription; var place = (itemRoom==' ') ? '' : 'Room '+itemRoom; var description = [&quot;Calendar entry generated by Andrew Millard's timetableToCalendar.js.&quot;, 'Original Durham University timetable entry downloaded on '+Date(), 'from '+window.location.href, '------------', 'Day: '+itemDay, 'Activity: '+itemActivity, 'Description: '+ itemDescription, 'Module: '+ itemModule, 'Start: '+ itemStart, 'End: '+ itemEnd, 'Duration: '+ itemDuration, 'Room: '+ itemRoom, 'Staff: '+ itemStaff, 'Weeks: '+ itemWeeks, 'Planned Size: '+ itemSize, '------------' ].join('\\n'); var startHour = parseInt(itemStart); var startMinute = parseInt(itemStart.substr(-2,2)); var durationHour = parseInt(itemDuration); var durationMinute = parseInt(itemDuration.substr(-2,2)); var endHour = startHour+durationHour + Math.floor((startMinute + durationMinute)/60); var endMinute = (startMinute + durationMinute) % 60; for (w=0;w&lt;weeksList.length;w++){ /* here loop through the weeks and create calendar entries */ var teachingWeek = teachingWeeks[weeksList[w]-1]; var startDate = new Date(weekStartDates[weeksList[w]-1]); startDate.setDate(startDate.getDate() + dayOffset); startDate.setHours(startHour); startDate.setMinutes(startMinute); var endDate = new Date(weekStartDates[weeksList[w]-1]); endDate.setDate(endDate.getDate() + dayOffset); endDate.setHours(endHour); endDate.setMinutes(endMinute); eventDescription = '\\n'+'This event generated for timetable week '+weeksList[w]+ ', teaching week '+teachingWeek+&quot;.&quot;+'\\n'; calEntry.addEvent(title,description+eventDescription, place, startDate.toUTCString(), endDate.toUTCString()); var ssd = new Date(weekStartDates[weeksList[w]-1]); } nEvents += weeksList.length; } } } confirmed = confirm(&quot;Are you sure you want to download &quot;+nEvents+&quot; calendar entries for 2021-22?&quot;); if (confirmed) { /* download ics file*/ calEntry.download('DurhamTimetable'); } } void(0); })();">tt2ics</a>
</p>

<p>This utility is designed to work on list-style output from the Durham University online timetable. If you try to use it on any other webpage it will generate an error message and do nothing. It will read all the data from the timetable output and convert it to the internet calendar specification (ics) format which can be read by Outlook and other calendar programs. <strong>WARNING: this utility can generate large numbers of calendar entries, which if imported into Outlook in error you may have to delete one by one.</strong> I advise (a) that you save the file and do not automatically import into your calendar, and (b) do some test runs with only one or two events in them to see how it works. You might like to use <a href="https://timetable.dur.ac.uk/reporting/textspreadsheet;module;name;ARCH1041%0D%0A?days=1-5&weeks=12&periods=5-41&template=module+textspreadsheet&height=100&week=100">this one</a> with only one entry, and delete it after you have tried the import. Outlook may complain that the file does not meet the ics standard, but this does not seem to affect the import. </p>

<p><strong>Instructions for importing into Outlook on Windows.</strong> Go to <em>File</em>, then <em>Open &amp; Export</em> and click on the <em>Import/Export</em> button. Choose <em>Import an iCalendar (.ics) or vCalendar file (.vcs)</em> and click <em>Next</em>. Navigate to your saved ics file and click <em>OK</em>. You have the choice of <em>Open as new</em> or <em>Import</em>. The first option will open the ics file as a new calendar, which may be useful for checking that things import as you expect, and you can delete the whole of the new calendar  after checking. The second option imports the calendar entries into your default calendar, which is what you want to do once you are assured that everything is OK. Any entries imported here can only be removed one by one.</p>

<p>After importing you will probably want to edit the entries. The best I can automatically generate for the title of an entry is the Activity description from the timetable (e.g., ARCH1041/LECT/001) and sometimes the module name. The description area of each auto-generated entry contains all the raw information from the University timetable, and a link to the search that you used to generate the entry. This should allow you to check the timetable entry and easily return to it.</p>

<p class="footer">Page last updated: 2021-09-22</p>
</body>
</html>